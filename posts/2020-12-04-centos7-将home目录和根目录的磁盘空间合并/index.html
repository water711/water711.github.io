<!doctype html>
<html lang="en-us">
  <head>
    <title>Centos7 将home目录和根目录的磁盘空间合并 // 蔡振威的博客</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.107.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.9e9c6027c30f5aa9423b581bd9cddd1ddc66088adb9c2604f89eb5828efea5a1.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Centos7 将home目录和根目录的磁盘空间合并"/>
<meta name="twitter:description" content="1、查看当前磁盘空间使用情况 [root@BK ~]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 1.8G 0 1.8G 0% /dev tmpfs 1.9G 0 1.9G 0% /dev/shm tmpfs 1.9G 8.9M 1.8G 1% /run tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup /dev/mapper/centos-root 411G 1.8G 409G 1% / /dev/sda1 1014M 192M 823M 19% /boot /dev/mapper/centos-home 50G 33M 50G 1% /home tmpfs 371M 0 371M 0% /run/user/0
2、备份/home目录 [root@BK ~]# cp -rp /home/ /tmp/
-r 递归复制该目录下的子目录 -p 将文件和目录具有的权限一同复制"/>

    <meta property="og:title" content="Centos7 将home目录和根目录的磁盘空间合并" />
<meta property="og:description" content="1、查看当前磁盘空间使用情况 [root@BK ~]# df -h Filesystem Size Used Avail Use% Mounted on devtmpfs 1.8G 0 1.8G 0% /dev tmpfs 1.9G 0 1.9G 0% /dev/shm tmpfs 1.9G 8.9M 1.8G 1% /run tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup /dev/mapper/centos-root 411G 1.8G 409G 1% / /dev/sda1 1014M 192M 823M 19% /boot /dev/mapper/centos-home 50G 33M 50G 1% /home tmpfs 371M 0 371M 0% /run/user/0
2、备份/home目录 [root@BK ~]# cp -rp /home/ /tmp/
-r 递归复制该目录下的子目录 -p 将文件和目录具有的权限一同复制" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://water711.github.io/posts/2020-12-04-centos7-%E5%B0%86home%E7%9B%AE%E5%BD%95%E5%92%8C%E6%A0%B9%E7%9B%AE%E5%BD%95%E7%9A%84%E7%A3%81%E7%9B%98%E7%A9%BA%E9%97%B4%E5%90%88%E5%B9%B6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-04T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-12-04T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://water711.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">蔡振威的博客</span>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Centos7 将home目录和根目录的磁盘空间合并</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 4, 2020
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p> </p>
<h2 id="1查看当前磁盘空间使用情况">1、查看当前磁盘空间使用情况</h2>
<p>[root@BK ~]# df -h
Filesystem Size Used Avail Use% Mounted on
devtmpfs 1.8G 0 1.8G 0% /dev
tmpfs 1.9G 0 1.9G 0% /dev/shm
tmpfs 1.9G 8.9M 1.8G 1% /run
tmpfs 1.9G 0 1.9G 0% /sys/fs/cgroup
/dev/mapper/centos-root 411G 1.8G 409G 1% /
/dev/sda1 1014M 192M 823M 19% /boot
/dev/mapper/centos-home 50G 33M 50G 1% /home
tmpfs 371M 0 371M 0% /run/user/0</p>
<h2 id="2备份home目录">2、备份/home目录</h2>
<p>[root@BK ~]# cp -rp /home/ /tmp/</p>
<p>-r 递归复制该目录下的子目录
-p 将文件和目录具有的权限一同复制</p>
<h2 id="3卸载home分区">3、卸载/home分区</h2>
<p>[root@BK ~]# umount /home
umount: /home: target is busy.
(In some cases useful info about processes that use
the device is found by lsof(8) or fuser(1))</p>
<p>如果提示 umount: /home: target is busy，使用fuser命令查看当前在使用home目录的进程，并结束进程</p>
<p>[root@BK ~]# yum install psmisc
[root@BK ~]# fuser -m /home
/home: 17736c 17795c</p>
<p>[root@BK ~]# kill -9 17736 17795
[root@BK ~]# umount /home</p>
<h2 id="4在fstab文件注释home目录取消开机挂载">4、在fstab文件注释/home目录，取消开机挂载</h2>
<p>[root@BK ~]# vim /etc/fstab
#/dev/mapper/centos-home /home xfs defaults 0 0</p>
<h2 id="5删除home所在的lvlogical-volume">5、删除/home所在的LV(logical volume)</h2>
<p>[root@BK ~]# lvremove /dev/mapper/centos-home
Do you really want to remove active logical volume centos/home? [y/n]: y
Logical volume &ldquo;home&rdquo; successfully removed</p>
<h2 id="6查看vgvolume-group未分配的空间大小free-pe--size-">6、查看VG(volume group)未分配的空间大小（Free PE / Size ）</h2>
<p>[root@BK ~]# vgdisplay
&mdash; Volume group &mdash;
VG Name centos
System ID
Format lvm2
Metadata Areas 1
Metadata Sequence No 5
VG Access read/write
VG Status resizable
MAX LV 0
Cur LV 2
Open LV 2
Max PV 0
Cur PV 1
Act PV 1
VG Size &lt;464.76 GiB
PE Size 4.00 MiB
Total PE 118978
Alloc PE / Size 106178 / &lt;414.76 GiB
Free PE / Size 12800 / 50.00 GiB
VG UUID FLbm62-WMrB-1ozX-1hdm-5IuW-e49l-AYy99C</p>
<h2 id="7扩展root所在的lvlogical-volume空间">7、扩展/root所在的LV(logical volume)空间</h2>
<p>[root@BK ~]# lvextend -L +50G /dev/mapper/centos-root
Size of logical volume centos/root changed from &lt;410.77 GiB (105156 extents) to &lt;428.77 GiB (109764 extents).
Logical volume centos/root successfully resized.</p>
<h2 id="8扩展xfs文件系统空间">8、扩展xfs文件系统空间</h2>
<p>[root@BK ~]# xfs_growfs /dev/mapper/centos-root</p>
<p>PS：如果是ext文件系统,则使用resize2fs命令扩展文件系统</p>
<h2 id="9查看扩容后根目录空间大小">9、查看扩容后根目录空间大小</h2>
<p>[root@BK ~]# df -H
Filesystem Size Used Avail Use% Mounted on
devtmpfs 2.0G 0 2.0G 0% /dev
tmpfs 2.0G 0 2.0G 0% /dev/shm
tmpfs 2.0G 9.3M 2.0G 1% /run
tmpfs 2.0G 0 2.0G 0% /sys/fs/cgroup
/dev/mapper/centos-root 495G 1.9G 493G 1% /
/dev/sda1 1.1G 201M 863M 19% /boot
tmpfs 389M 0 389M 0% /run/user/0</p>
<h2 id="10将备份的文件拷贝回home目录">10、将备份的文件拷贝回/home目录</h2>
<p>[root@BK ~]# cp -rp /tmp/home/* /home/</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
