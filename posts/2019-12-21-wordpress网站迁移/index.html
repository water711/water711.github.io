<!doctype html>
<html lang="en-us">
  <head>
    <title>Wordpress网站迁移 // 蔡振威的博客</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.107.0">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.9e9c6027c30f5aa9423b581bd9cddd1ddc66088adb9c2604f89eb5828efea5a1.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Wordpress网站迁移"/>
<meta name="twitter:description" content="博客原本部署在阿里云虚拟主机上，今年双11，购买了一台阿里云ECS服务器，现在开始做迁移
一、备份网站空间及数据库 二、阿里云ECS部署LNMP环境 #安装nginx和mariadb [root@ecs]# yum -y install nginx mariadb mariadb-server [root@ecs]# systemctl start nginx mariadb [root@ecs]# systemctl enable nginx mariadb
#EPEL源的php版本较低，安装第三方源 [root@ecs]# rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm [root@ecs]# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
[root@ecs]# yum -y install php56w php56w-fpm php56w-mysql php56w-gd [root@ecs]# systemctl start php-fpm [root@ecs]# systemctl enable php-fpm
#把nginx主配置文件的server段注释掉 [root@ecs]# vim /etc/nginx/nginx.conf
server { listen 80 default_server; listen [::]:80 default_server; server_name _; root /usr/share/nginx/html; # Load configuration files for the default server block."/>

    <meta property="og:title" content="Wordpress网站迁移" />
<meta property="og:description" content="博客原本部署在阿里云虚拟主机上，今年双11，购买了一台阿里云ECS服务器，现在开始做迁移
一、备份网站空间及数据库 二、阿里云ECS部署LNMP环境 #安装nginx和mariadb [root@ecs]# yum -y install nginx mariadb mariadb-server [root@ecs]# systemctl start nginx mariadb [root@ecs]# systemctl enable nginx mariadb
#EPEL源的php版本较低，安装第三方源 [root@ecs]# rpm -Uvh https://mirror.webtatic.com/yum/el7/epel-release.rpm [root@ecs]# rpm -Uvh https://mirror.webtatic.com/yum/el7/webtatic-release.rpm
[root@ecs]# yum -y install php56w php56w-fpm php56w-mysql php56w-gd [root@ecs]# systemctl start php-fpm [root@ecs]# systemctl enable php-fpm
#把nginx主配置文件的server段注释掉 [root@ecs]# vim /etc/nginx/nginx.conf
server { listen 80 default_server; listen [::]:80 default_server; server_name _; root /usr/share/nginx/html; # Load configuration files for the default server block." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://water711.github.io/posts/2019-12-21-wordpress%E7%BD%91%E7%AB%99%E8%BF%81%E7%A7%BB/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-12-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-12-21T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://water711.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <span class="app-header-title">蔡振威的博客</span>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Wordpress网站迁移</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Dec 21, 2019
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p>博客原本部署在阿里云虚拟主机上，今年双11，购买了一台阿里云ECS服务器，现在开始做迁移</p>
<p> </p>
<h2 id="一备份网站空间及数据库">一、备份网站空间及数据库</h2>
<h2 id="二阿里云ecs部署lnmp环境">二、阿里云ECS部署LNMP环境</h2>
<p>#安装nginx和mariadb
[root@ecs]# yum -y install nginx mariadb mariadb-server
[root@ecs]# systemctl start nginx mariadb
[root@ecs]# systemctl enable nginx mariadb</p>
<p>#EPEL源的php版本较低，安装第三方源
[root@ecs]# rpm -Uvh <a href="https://mirror.webtatic.com/yum/el7/epel-release.rpm">https://mirror.webtatic.com/yum/el7/epel-release.rpm</a>
[root@ecs]# rpm -Uvh <a href="https://mirror.webtatic.com/yum/el7/webtatic-release.rpm">https://mirror.webtatic.com/yum/el7/webtatic-release.rpm</a></p>
<p>[root@ecs]# yum -y install php56w php56w-fpm php56w-mysql php56w-gd
[root@ecs]# systemctl start php-fpm
[root@ecs]# systemctl enable php-fpm</p>
<p> </p>
<p>#把nginx主配置文件的server段注释掉
[root@ecs]# vim /etc/nginx/nginx.conf</p>
<h1 id="server-">server {</h1>
<h1 id="listen-------80-default_server">listen       80 default_server;</h1>
<h1 id="listen-------80-default_server-1">listen       [::]:80 default_server;</h1>
<h1 id="server_name--_">server_name  _;</h1>
<h1 id="root---------usrsharenginxhtml">root         /usr/share/nginx/html;</h1>
<h1 id="heading"></h1>
<h1 id="-load-configuration-files-for-the-default-server-block"># Load configuration files for the default server block.</h1>
<h1 id="include-etcnginxdefaultdconf">include /etc/nginx/default.d/*.conf;</h1>
<h1 id="heading-1"></h1>
<h1 id="location--">location / {</h1>
<h1 id="heading-2">}</h1>
<h1 id="heading-3">&hellip;&hellip;.</h1>
<h1 id="heading-4">}</h1>
<h1 id="heading-5">}</h1>
<p> </p>
<p>#配置nginx虚拟主机
[root@ecs]# vim /etc/nginx/conf.d/caizhenwei.conf</p>
<p>upstream php {
server unix:/tmp/php-cgi.socket;
server 127.0.0.1:9000;
}</p>
<p>server {
server_name caizhenwei.top;
root /usr/share/nginx/wordpress;
index index.php;</p>
<pre><code>    location / {
            try\_files $uri $uri/ /index.php?$args;  #wordpress伪静态
    }

    location ~ \\.php$ {
            #NOTE: You should have &quot;cgi.fix\_pathinfo = 0;&quot; in php.ini
            include fastcgi.conf;
            fastcgi\_intercept\_errors on;
            fastcgi\_pass php;
    }

    location ~\* \\.(js|css|png|jpg|jpeg|gif|ico)$ {
            expires max;
            log\_not\_found off;
    }
</code></pre>
<p>}</p>
<h2 id="三导入网站及数据库">三、导入网站及数据库</h2>
<p>#导入网站
[root@ecs]# unzip -d /usr/share/nginx/wordpress web_bakcup.zip  #解压备份好的网站，到指定目录
[root@ecs]# chown -R nginx:nginx /usr/share/nginx/wordpress  #修改网站目录属主和属组</p>
<p>#修改php-fpm运行的用户和组（因为使用这个源安装的php，默认是以apache用户运行的，如果不修改为nginx用户，会因为权限问题无法上传文件）
[root@ecs]# vim /etc/php-fpm.d/www.conf<br>
user = nginx
group = nginx</p>
<p>#导入数据库
[root@ecs]# mysql -uroot -p
MariaDB [(none)]&gt; CREATE DATABASE `wordpress` DEFAULT CHARACTER SET utf8;  #创建数据库
MariaDB [(none)]&gt; use wordpress
MariaDB [(none)]&gt; source /tmp/backup.sql  #导入数据库</p>
<p>MariaDB [(none)]&gt; grant all on wordpress.* to &lsquo;user&rsquo;@&rsquo;localhost&rsquo; identified by &lsquo;123456&rsquo;;  #授权数据库用户
MariaDB [(none)]&gt; flush privileges;  #刷新授权表</p>
<p> </p>
<h2 id="四修改wordpress配置文件">四、修改wordpress配置文件</h2>
<p>[root@ecs]# vim wordpress/wp-config.php</p>
<p>/** WordPress数据库的名称 */
define(&lsquo;DB_NAME&rsquo;, &lsquo;wordpress&rsquo;);</p>
<p>/** MySQL数据库用户名 */
define(&lsquo;DB_USER&rsquo;, &lsquo;user&rsquo;);</p>
<p>/** MySQL数据库密码 */
define(&lsquo;DB_PASSWORD&rsquo;, &lsquo;123456&rsquo;);</p>
<p> </p>
<h2 id="五将域名解析到新服务器ip地址至此wordpress迁移完成">五、将域名解析到新服务器IP地址，至此，wordpress迁移完成</h2>
<h2 id="六升级wordpress最新版">六、升级wordpress最新版</h2>
<p>由于近段时间，国内无法正常访问wordpress官网，所以不能通过wordpress后台更新，只能手动下载wordpress更新</p>
<p>步骤：</p>
<p>1、备份网站，下载最新版wordpress</p>
<p>2、删除网站根目录下的wp-includes和wp-admin文件夹</p>
<p>3、解压最新版的WordPress，删除里面的wp-content文件夹，把新版wordpress上传并覆盖到网站目录</p>
<p>[root@ecs]# wget <a href="https://wordpress.org/wordpress-5.3.1-zh">https://wordpress.org/wordpress-5.3.1-zh</a>_CN.zip
[root@ecs]# unzip wordpress-5.3.1-zh_CN.zip  #解压
[root@ecs]# rm -rf ./wordpress-5.3.1/wp-content/  #解压后删除里面的wp-content目录</p>
<p>[root@ecs]# cd /usr/share/nginx/wordpress/  #进入网站目录
[root@ecs]# rm -rf ./wordpress/wp-includes/ ./wordpress/wp-admin/  #删除网站wp-includes、wp-admin目录
[root@ecs]# /bin/cp -rf /root/wordpress/* /usr/share/nginx/wordpress/  #把新版wordpress上传并覆盖到博客网站目录</p>
<p>浏览器访问：http://域名/wp-admin/upgrade.php</p>
<p><img src="http://hugo.caizhenwei.top//415c565042647ccb10a712dcd0f31d57.png" alt=""></p>
<p> </p>
<h2 id="七搭建ftp服务用于方便上传或下载网站文件">七、搭建FTP服务，用于方便上传或下载网站文件</h2>
<p>#安装并配置ftp
[root@ecs]# yum -y install vsftpd
[root@ecs]# vim /etc/vsftpd/vsftpd.conf
anonymous_enable=NO #关闭匿名访问
chroot_local_user=YES  #限制用户只能访问为其配置的目录（用户主目录不能再有写权限）</p>
<p>[root@ecs]# vim /etc/pam.d/vsftpd
#auth  required  pam_shells.so  #将这行注释，不检查用户shell的有效性</p>
<p>#新建用户，并把网站目录设为用户家目录
[root@ecs]# mkdir -p /webdata/wordpress/htdocs/  #创建目录
[root@ecs]# useradd -s /sbin/nologin -d /webdata/wordpress/ ftpuser  #创建用户并指定其家目录
[root@ecs]# passwd ftpuser  #设置ftp用户密码</p>
<p>#将网站文件移动到FTP用户家目录下的htdocs
[root@ecs]# mv ./wordpress/* /webdata/wordpress/htdocs/ #移动网站
[root@ecs]# vim /etc/nginx/conf.d/caizhenwei.conf #修改nginx配置文件的网站根目录</p>
<p>#修改网站目录属主和个别目录写权限
[root@ecs]# chown -R ftpuser:ftpuser /webdata/wordpress/   #修改ftp用户家目录属主
[root@ecs]# chown a-w /webdata/wordpress/  #从2.3.5之后，vsftpd增强了安全检查，如果用户被限定在了其主目录下，则该用户的主目录不能再具有写权限
[root@ecs]# chmod -R 777 /webdata/wordpress/htdocs/wp-content/uploads/  #修改上传目录写权限
[root@ecs]# chmod -R 777 /webdata/wordpress/htdocs/wp-content/themes/yusi1.0/cache/  #修改缩略图缓存目录写权限</p>
<p>#启动vsftpd服务
[root@ecs]# systemctl restart vsftpd.service
[root@ecs]# systemctl enable vsftpd.service</p>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
